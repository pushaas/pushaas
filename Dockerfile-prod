FROM golang:1.12

ENV GO111MODULE=on
ENV PUSHAAS_ENV=prod
ENV PUSHAAS_CONF=./dist/config.yml

WORKDIR /app

# cache go modules
COPY go.mod .
COPY go.sum .
RUN go mod download

COPY . .

EXPOSE 9000

RUN rm -fr ./dist && mkdir ./dist
RUN cp ./config/prod.yml ./dist/config.yml
RUN make build

# TODO pass environment variables
ENTRYPOINT ["./dist/pushaas"]
